# 日志轮转配置文件

# 全局配置
weekly
rotate 52
compress
delaycompress
missingok
notifempty
create 644 root root
dateext
dateformat -%Y%m%d-%s

# 应用程序日志
/var/log/app/*.log {
    daily
    rotate 30
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 644 app app
    postrotate
        /bin/kill -USR1 $(cat /var/run/app.pid 2>/dev/null) 2>/dev/null || true
    endscript
}

# Nginx 访问日志
/var/log/nginx/access.log {
    daily
    rotate 30
    size 500M
    compress
    delaycompress
    missingok
    notifempty
    create 644 nginx nginx
    sharedscripts
    postrotate
        /bin/kill -USR1 $(cat /var/run/nginx.pid 2>/dev/null) 2>/dev/null || true
    endscript
}

# Nginx 错误日志
/var/log/nginx/error.log {
    daily
    rotate 30
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 644 nginx nginx
    sharedscripts
    postrotate
        /bin/kill -USR1 $(cat /var/run/nginx.pid 2>/dev/null) 2>/dev/null || true
    endscript
}

# PostgreSQL 日志
/var/log/postgresql/*.log {
    daily
    rotate 30
    size 200M
    compress
    delaycompress
    missingok
    notifempty
    create 644 postgres postgres
    postrotate
        /usr/bin/pg_ctl reload -D /var/lib/postgresql/data 2>/dev/null || true
    endscript
}

# Redis 日志
/var/log/redis/*.log {
    daily
    rotate 30
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 644 redis redis
    postrotate
        /bin/kill -USR1 $(cat /var/run/redis.pid 2>/dev/null) 2>/dev/null || true
    endscript
}

# Fluentd 日志
/var/log/fluentd/*.log {
    daily
    rotate 14
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    create 644 fluentd fluentd
    postrotate
        /bin/kill -USR1 $(cat /var/run/fluentd.pid 2>/dev/null) 2>/dev/null || true
    endscript
}

# 系统日志
/var/log/syslog {
    daily
    rotate 30
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 644 syslog adm
    postrotate
        /usr/lib/rsyslog/rsyslog-rotate
    endscript
}

# 安全日志
/var/log/auth.log {
    daily
    rotate 90
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    create 644 root adm
}

# 内核日志
/var/log/kern.log {
    daily
    rotate 30
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    create 644 root adm
}

# Docker 容器日志
/var/lib/docker/containers/*/*.log {
    daily
    rotate 7
    size 10M
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
}

# 监控系统日志
/var/log/prometheus/*.log {
    daily
    rotate 14
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    create 644 prometheus prometheus
    postrotate
        /bin/kill -HUP $(cat /var/run/prometheus.pid 2>/dev/null) 2>/dev/null || true
    endscript
}

/var/log/grafana/*.log {
    daily
    rotate 14
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    create 644 grafana grafana
    postrotate
        /bin/kill -HUP $(cat /var/run/grafana.pid 2>/dev/null) 2>/dev/null || true
    endscript
}

# 备份日志清理
/var/log/fluentd/backup/*.gz {
    weekly
    rotate 12
    maxage 90
    compress
    missingok
    notifempty
}