<system>
  log_level info
  suppress_repeated_stacktrace true
  emit_error_log_interval 30s
  suppress_config_dump
  without_source
</system>

<source>
  @type forward
  port 24224
  bind 0.0.0.0
  tag input.forward
</source>

<source>
  @type tail
  path /var/log/app/*.log
  pos_file /var/log/fluentd-app.log.pos
  tag app.*
  <parse>
    @type json
    time_key timestamp
    time_format %Y-%m-%dT%H:%M:%S.%L%z
  </parse>
</source>

<source>
  @type tail
  path /var/log/nginx/*.log
  pos_file /var/log/fluentd-nginx.log.pos
  tag nginx.*
  <parse>
    @type nginx
  </parse>
</source>

<match **>
  @type elasticsearch
  host elasticsearch
  port 9200
  logstash_format true
  logstash_prefix fluentd
  logstash_dateformat %Y%m%d
  include_tag_key true
  tag_key @log_name
  flush_interval 1s
  suppress_type_name true
  <buffer>
    flush_interval 1s
    flush_mode interval
    retry_type exponential_backoff
    retry_wait 1s
    retry_max_interval 30s
    retry_timeout 72h
    overflow_action block
  </buffer>
</match>